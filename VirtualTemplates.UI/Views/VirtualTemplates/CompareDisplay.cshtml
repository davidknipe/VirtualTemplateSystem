@using System.Web.Mvc.Html
@using EPiServer.Shell.Web.Mvc.Html
@model VirtualTemplates.UI.Models.VirtualTemplatesCompareModel

@{
    Layout = null;
}


<!DOCTYPE html>
<html lang="en">
<head>
    <title>Virtual Template System</title>
    <!-- Include Ace editor first -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ace.js" integrity="sha384-mIyND45gVTxAv3Fgk1Vv2O35/37OLb8SLI2iCAmhJoWEpeTA5cw0lSkiSmvNAhVF" crossorigin="anonymous"></script>
    <!-- Include Ace-diff JS and CSS (using unpkg.com CDN in this case) -->
    <script src="https://unpkg.com/ace-diff@2.3.0/dist/ace-diff.min.js" integrity="sha384-Pe0OY38CqAVdYPDI85ehYesCmISM2BbmFcKLuj0J2epGYjGWNBbwACsT8EOpGuY9" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/ace-diff@2.3.0/dist/ace-diff.min.css" integrity="sha384-Mxfhmq9U1mo82P5ebVySECYFSwf+FpWbEQcE1e0U/AIJKBzFOiGpKAvpRIUcy4eY" crossorigin="anonymous">
</head>

<body>
    <!-- Element we will use to render the Ace-diff -->
    <div class="custom"></div>
    <div id="codepanel" style="display: none;"></div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ext-modelist.js" type="text/javascript"></script>
<script>
    function getMode(path){
        var modelist = ace.require("ace/ext/modelist");
        return modelist.getModeForPath(path).mode;
    }

    var filename = "@Model.VirtualPath";
    var aceDiffer = new AceDiff({
        element: '.custom',
        left: {
            content: `@Html.Raw(Model.LeftContents.Replace("${", "\\${").Replace("</script", "<\\/script"))`,
            copyLinkEnabled: false
        },
        right: {
            content: `@Html.Raw(Model.RightContents.Replace("${", "\\${").Replace("</script", "<\\/script"))`,
            editable: false
        },
    });
    var mode = getMode(filename);
    ace.require(mode);
    var leftEditor = aceDiffer.getEditors().left;
    leftEditor.session.setMode(mode);
    var rightEditor = aceDiffer.getEditors().right;
    rightEditor.session.setMode(mode);
    leftEditor.getSession().on('change', function (e) {
        window.top.document.getElementById("TemplateContents").value = leftEditor.getValue();
    });

    window.onload = function() {
        parent.compareLoaded('@Model.LeftVersionText', '@Model.RightVersionText');
    }

</script>
</body>
</html>