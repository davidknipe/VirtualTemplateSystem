@using System.Web.Mvc.Html
@using EPiServer.Shell.Web.Mvc.Html
@model VirtualTemplates.UI.Models.VirtualTemplatesCompareModel

@{
    Layout = null;
}


<!DOCTYPE html>
<html lang="en">
<head>
    <title>Ace-diff - Demo #1</title>
    <!-- Include Ace editor first -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ace.js"></script>
    <!-- Include Ace-diff JS and CSS (using unpkg.com CDN in this case) -->
    <script src="https://unpkg.com/ace-diff&#64;^2"></script>
    <link href="https://unpkg.com/ace-diff&#64;^2/dist/ace-diff.min.css" rel="stylesheet">
</head>

<body>
    <!-- Element we will use to render the Ace-diff -->
    <div class="custom"></div>
    <div id="codepanel" style="display: none;"></div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ext-modelist.js" type="text/javascript"></script>
<script>
    function getMode(path){
        var modelist = ace.require("ace/ext/modelist");
        return modelist.getModeForPath(path).mode;
    }

    var filename = "@Model.VirtualPath";
    var aceDiffer = new AceDiff({
        element: '.custom',
        left: {
            content: `@Html.Raw(Model.TemplateContents.Replace("${", "\\${"))`,
            copyLinkEnabled: false
        },
        right: {
            content: `@Html.Raw(Model.OriginalContents.Replace("${", "\\${"))`,
            editable: false
        },
    });
    var mode = getMode(filename);
    ace.require(mode);
    var leftEditor = aceDiffer.getEditors().left;
    leftEditor.session.setMode(mode);
    var rightEditor = aceDiffer.getEditors().right;
    rightEditor.session.setMode(mode);
    leftEditor.getSession().on('change', function (e) {
        window.top.document.getElementById("TemplateContents").value = leftEditor.getValue();
    });

</script>
</body>
</html>